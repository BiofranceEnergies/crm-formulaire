<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire CRM - GitHub Pages</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        form { max-width: 800px; margin: auto; background: #f9f9f9; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; }
        textarea { height: 100px; resize: vertical; }
        select[multiple] { height: 150px; }
        button { margin-top: 20px; padding: 15px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; }
        button:hover { background-color: #45a049; }
        .success { color: green; font-weight: bold; margin-top: 20px; }
        .error { color: red; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

    <h2>Formulaire CRM - Informations Client</h2>
    <form id="crmForm">
        <label for="nom">Nom + Prénom :</label>
        <input type="text" id="nom" name="nom" required>

        <label for="adresse">Adresse :</label>
        <input type="text" id="adresse" name="adresse" required>

        <label for="cp_ville">Code Postal + Ville :</label>
        <input type="text" id="cp_ville" name="cp_ville" required>

        <label for="tel">Téléphone :</label>
        <input type="tel" id="tel" name="tel" required>

        <label for="mail">E-mail (facultatif) :</label>
        <input type="email" id="mail" name="mail">

        <label for="chauffage">Type de chauffage (plusieurs choix possibles) :</label>
        <select id="chauffage" name="chauffage" multiple required>
            <option value="Électrique">Électrique</option>
            <option value="Gaz">Gaz</option>
            <option value="Fioul">Fioul</option>
            <option value="Bois">Bois</option>
        </select>

        <label for="fact_elec">Facture Électricité (€) :</label>
        <input type="number" id="fact_elec" name="fact_elec" required>

        <label for="type_toiture">Type de toiture :</label>
        <select id="type_toiture" name="type_toiture" required>
            <option value="">-- Sélectionner un type de toiture --</option>
            <option value="Tuile">Tuile</option>
            <option value="Ardoise">Ardoise</option>
            <option value="Acier">Acier</option>
            <option value="Zinc">Zinc</option>
            <option value="Bac acier">Bac acier</option>
            <option value="Bois">Bois</option>
            <option value="Béton">Béton</option>
            <option value="Terrasse">Toit terrasse</option>
            <option value="Autre">Autre</option>
        </select>

        <label for="orientation">Orientation toiture :</label>
        <select id="orientation" name="orientation" required>
            <option value="">-- Sélectionner une orientation --</option>
            <option value="Sud">Sud</option>
            <option value="Sud-Est">Sud-Est</option>
            <option value="Sud-Ouest">Sud-Ouest</option>
            <option value="Est">Est</option>
            <option value="Ouest">Ouest</option>
            <option value="Nord">Nord</option>
            <option value="Nord-Est">Nord-Est</option>
            <option value="Nord-Ouest">Nord-Ouest</option>
        </select>

        <label for="commentaire">Commentaire :</label>
        <textarea id="commentaire" name="commentaire" placeholder="Ajoutez ici des commentaires ou remarques complémentaires..."></textarea>

        <label for="date_rdv">Date du rendez-vous :</label>
        <input type="date" id="date_rdv" name="date_rdv">

        <label for="rdv_pris_par">RDV pris par :</label>
        <input type="text" id="rdv_pris_par" name="rdv_pris_par" required>

        <button type="submit">Envoyer les données</button>
        <div id="message"></div>
    </form>

    <script>
        document.getElementById("crmForm").addEventListener("submit", function(event) {
            event.preventDefault();

            const selectedChauffage = Array.from(document.getElementById("chauffage").selectedOptions)
                                          .map(option => option.value).join(", ");

            const formData = {
                nom: document.getElementById("nom").value,
                adresse: document.getElementById("adresse").value,
                cp_ville: document.getElementById("cp_ville").value,
                tel: document.getElementById("tel").value,
                mail: document.getElementById("mail").value || '',
                chauffage: selectedChauffage,
                fact_elec: document.getElementById("fact_elec").value,
                type_toiture: document.getElementById("type_toiture").value,
                orientation: document.getElementById("orientation").value,
                commentaire: document.getElementById("commentaire").value,
                date_rdv: document.getElementById("date_rdv").value || 'LEADS',
                rdv_pris_par: document.getElementById("rdv_pris_par").value
            };

            fetch("https://script.google.com/macros/s/AKfycbyxQqsC9Tzq_24R3qw-QQDaHabrq3mNnvlSahIiXYkAaqZWwRYjRXvC86yguc_AWaZ_5w/exec", {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData)
            })
            .then(() => {
                document.getElementById("message").innerHTML = '<p class="success">✅ Données envoyées avec succès (\"LEADS\" si la date est vide) !</p>';
                document.getElementById("crmForm").reset();
            })
            .catch(error => {
                console.error("Erreur :", error);
                document.getElementById("message").innerHTML = `<p class="error">❌ Une erreur s'est produite : ${error.message}</p>`;
            });
        });
    </script>
</body>
</html>
